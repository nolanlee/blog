---
date: 2019-12-11
author: Nolan
location: Beijing
---
# Hello, WebAssembly

> MDN: WebAssemblyæ˜¯ä¸€ç§æ–°çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥åœ¨ç°ä»£æµè§ˆå™¨ä¸­è¿è¡Œ ï¼ å®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œï¼Œå¹¶ä¸ºè¯¸å¦‚C / C ++ç­‰è¯­è¨€æä¾›ä¸€ä¸ªç¼–è¯‘ç›®æ ‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨Webä¸Šè¿è¡Œã€‚å®ƒä¹Ÿè¢«è®¾è®¡ä¸ºå¯ä»¥ä¸JavaScriptå…±å­˜ï¼Œå…è®¸ä¸¤è€…ä¸€èµ·å·¥ä½œã€‚

## èµ·æº

### JS ç®€å²

JavaScript çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºéä¸“ä¸šç¼–ç¨‹äººå‘˜å’Œè®¾è®¡å¸ˆä½¿ç”¨çš„ï¼Œç”¨ä½œè½»é‡çº§çš„ç®€å•æ“ä½œçš„ä¸€ç§èƒ¶æ°´è¯­è¨€ã€‚JS çš„ä½œè€… Brendan Eich è®¤ä¸ºè®©éä¸“ä¸šäººå‘˜å­¦ä¹ äº†è§£ä»€ä¹ˆæ˜¯ç±»å‹ã€ç¼–è¯‘å™¨ï¼ˆCPUå·¥ä½œåŸç†ï¼‰ã€æ³›å‹ã€æ“ä½œç¬¦é‡è½½æ˜¯ä¸€ä»¶å¾ˆâ€œæ®‹å¿â€çš„äº‹æƒ…ã€‚ä¸‡ä¸‡æ²¡æƒ³åˆ°çš„æ˜¯ï¼ŒJS å‘å¸ƒä»¥åç«çš„ä¸€å¡Œç³Šæ¶‚ï¼Œå„å¤§æµè§ˆå™¨çº·çº·æ”¯æŒæˆ–è€…æ•ˆä»¿ï¼ˆJScriptï¼ŒVBScriptï¼‰ã€‚åæ¥éšç€ ECMA çš„åè°ƒï¼Œå„å¤§æµè§ˆå™¨ç»ˆäºç»Ÿä¸€äº† JS çš„æ ‡å‡†ã€‚éšç€ Web2.0 çš„å‘å±•ï¼ŒDOMã€BOMã€JSçš„åŠŸèƒ½è¶Šæ¥è¶Šä¸°å¯Œï¼ŒWeb åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œæµè§ˆå™¨çš„ JS å¼•æ“ä¹Ÿå¼€å§‹å‡ºç°äº†æ€§èƒ½ç“¶é¢ˆã€‚

JS çš„æ€§èƒ½ç“¶é¢ˆä¸»è¦ç”±è¯­è¨€æœ¬èº«çš„é—®é¢˜å¼•èµ·çš„ï¼Œå› ä¸º JS æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ã€‚åœ¨é™æ€ç±»å‹è¯­è¨€ä¸­ï¼Œæ¯”å¦‚ C++ å’Œ Javaï¼Œä¸€ä¸ªå¯¹è±¡çš„å˜é‡ç±»å‹æ˜¯ç¡®å®šçš„ï¼Œå†…å­˜åˆ†é…çš„å­—èŠ‚æ•°æ˜¯ç¡®å®šçš„ï¼Œå¯ä»¥ç”¨æ•°ç»„æ¥å­˜å‚¨å˜é‡çš„å€¼ï¼Œæ‰€ä»¥äº‹å…ˆçŸ¥é“å­˜å–è¿™äº›å˜é‡æ‰€åœ¨çš„å†…å­˜ä¸­çš„åç§»é‡ï¼Œè¯»å†™é€Ÿåº¦å¾ˆå¿«ã€‚è€Œå¤§éƒ¨åˆ† JS å¼•æ“ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å–å±æ€§å’Œå¯»æ‰¾æ–¹æ³•ï¼Œè·Ÿç›´æ¥ç”¨åç§»é‡å¯»å€æ¯”ä¼šè´¹æ—¶ã€‚

ç„¶åï¼Œå¤§å®¶éƒ½çŸ¥é“çš„ï¼ŒV8 å¼•æ“åº”è¿è€Œç”Ÿï¼ŒJS çš„æ€§èƒ½æå‡äº†20-50å€ã€‚

### V8 ä¸ºä»€ä¹ˆå¿«

V8 å¼•å…¥äº†ä¸€ç§åŠæ—¶ç¼–è¯‘æŠ€æœ¯ï¼ˆJITï¼Œjust-in-timeï¼‰æ¥ç”Ÿæˆæœºå™¨è¯­è¨€ã€‚è¿™æ˜¯ä¸ªæ™®éç”¨æ¥æ”¹å–„è§£æé€Ÿåº¦çš„æ–¹æ³•ï¼Œåœ¨ Java å’Œ .NET ç­‰è¯­è¨€ä¸­ä¹Ÿè¿ç”¨äº†è¿™ç§æŠ€æœ¯ã€‚V8 ä¸æ˜¯å°†åŸå§‹ç¨‹åºè½¬æ¢æˆä¸­é—´è¯­è¨€ï¼Œè€Œæ˜¯å°†æŠ½è±¡è¯­æ³•æ ‘ç›´æ¥äº§ç”Ÿæœºå™¨è¯­è¨€å¹¶åŠ ä»¥æ‰§è¡Œã€‚æ²¡æœ‰è™šæ‹Ÿæœºï¼Œå°±ä¸éœ€è¦ä¸­é—´å¤„ç†ï¼Œç¨‹åºå¤„ç†ä¼šæ›´æ—©å¼€å§‹äº†ã€‚ç„¶è€Œï¼Œå¦ä¸€æ–¹é¢ï¼Œå®ƒä¹Ÿä¸§å¤±äº†è™šæ‹Ÿæœºçš„å¥½å¤„ï¼Œä¾‹å¦‚é€è¿‡å­—èŠ‚ç è§£é‡Šå™¨å’Œæ··åˆæ¨¡å¼ç­‰ï¼Œæ‰€å¸¦æ¥çš„é«˜å¯ç§»æ¤æ€§å’Œä¼˜åŒ–çš„ç®€æ˜“æ€§ç­‰ã€‚

JIT åŸºäºè¿è¡Œæ—¶åˆ†æç¼–è¯‘ï¼Œè€Œ JS æ˜¯ä¸€ä¸ªæ²¡æœ‰ç±»å‹çš„è¯­è¨€ï¼Œäºæ˜¯ï¼Œ å¤§éƒ¨åˆ†æ—¶é—´ï¼ŒJIT ç¼–è¯‘å™¨å…¶å®æ˜¯åœ¨çŒœæµ‹ JS ä¸­çš„ç±»å‹ã€‚çŒœæ€»ä¼šæœ‰çŒœé”™çš„æ—¶å€™ï¼ŒçŒœé”™ä»¥ååªèƒ½æ¨å€’é‡æ¥ã€‚JIT å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œæœ‰æ—¶å€™è¿˜æ²¡æœ‰é‡ç¼–çš„å¼€é”€å¤§ã€‚äº‹å®ä¸Šï¼Œå¤§éƒ¨åˆ†æ—¶é—´ JIT éƒ½ä¸ä¼šç”Ÿæˆä¼˜åŒ–ä»£ç ï¼Œæœ‰å› ä¸º JIT è‡ªå·±ä¹Ÿéœ€è¦æ—¶é—´ï¼Œé™¤éæ˜¯ä¸€ä¸ªå‡½æ•°è¢«ä½¿ç”¨è¿‡å¾ˆå¤šéï¼Œå¦åˆ™ä¸ä¼šè¢«ç¼–è¯‘æˆæœºå™¨ç ï¼Œå› ä¸ºç¼–è¯‘èŠ±çš„æ—¶é—´å¯èƒ½æ¯”ç›´æ¥è·‘å­—èŠ‚ç è¿˜å¤šï¼Œä¹Ÿå› æ­¤è§¦ç¢°åˆ°äº† V8 æ€§èƒ½çš„å¤©èŠ±æ¿ã€‚

### æ‰“ç ´å¤©èŠ±æ¿

æ—¢ç„¶ JIT é‡åˆ°çš„é—®é¢˜æ˜¯ç±»å‹ä¸ç¡®å®šé—®é¢˜ï¼Œé‚£èƒ½å¦æœ‰ä¸€ç§æ–¹æ³•æŠŠç±»å‹æ ‡æ³¨å‡ºæ¥å‘¢ï¼ŸæŒ‰ç…§è¿™ç§æ€è·¯ï¼Œä¸šç•Œå‡ºç°äº†ä¸¤ç§æ–¹æ¡ˆï¼š

ä»¥ Typescriptï¼ŒDart ä¸ºä»£è¡¨çš„ä»¥ JS ä¸ºç¼–è¯‘ç›®æ ‡çš„å¼ºç±»å‹è¯­è¨€ã€‚ç”±äºå¼ºç±»å‹èŒƒå¼ï¼Œä¼šä½¿å¾— TS ç¼–è¯‘åçš„ JS æ›´å®¹æ˜“è¢« JIT ä¼˜åŒ–ã€‚

ä»¥ Asm.js ä¸ºä»£è¡¨æ ‡æ³¨æ–¹æ³•ã€‚Asm.js æ˜¯ Mozilla å¼€å‘çš„ JS çš„ä¸¥æ ¼å­é›†ï¼Œç›®çš„æ˜¯ç”¨äºå°†ä¼ ç»Ÿçš„å¼ºç±»å‹è¯­è¨€å¯ä»¥ç¼–è¯‘ä¸º Asm.js åç›´æ¥åœ¨æµè§ˆå™¨æ‰§è¡Œã€‚Firefox ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªæ”¯æŒè§£æ Asm.js çš„æµè§ˆå™¨ã€‚

```js
function f(i) {
  i = i|0;
  return (i + 1)|0;
}
```

å·¨å¤´ä»¬ï¼ˆGoogle, Appleï¼ŒMicroSoftï¼‰å‘ç° Asm.js è¿™ç§æ–¹å¼æ›´æœ‰å‰é€”ï¼Œå¹¶ä¸”å¯ä»¥æ›´æ¿€è¿›çš„ï¼Œç›´æ¥å°†å¼ºç±»å‹è¯­è¨€ç¼–è¯‘æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„å­—èŠ‚ç ã€‚è™½ç„¶ JS è¶³å¤Ÿå¼ºå¤§åˆ°èƒ½å¤Ÿè§£å†³äººç»å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½†é‡åˆ°3Dæ¸¸æˆã€AR/VRã€è®¡ç®—æœºè§†è§‰ã€å›¾åƒ/è§†é¢‘ç¼–è¾‘ç­‰å¤§é‡çš„è¦æ±‚åŸç”Ÿæ€§èƒ½çš„å…¶ä»–é¢†åŸŸçš„æ—¶å€™ï¼Œæ€§èƒ½é—®é¢˜æš´éœ²æ— é—ã€‚

äºæ˜¯ W3C å·¥ä½œç»„ä¸»å¯¼å¼€å‘ WebAssembly æ ‡å‡†ï¼Œå¹¶å¾—åˆ°äº†æ¥è‡ªå„å¤§ä¸»è¦æµè§ˆå™¨å‚å•†çš„ç§¯æå‚ä¸ï¼Œæ—¨åœ¨æä¾›äº†ä¸€æ¡é€”å¾„ï¼Œä»¥ä½¿å¾—ä»¥å„ç§è¯­è¨€ç¼–å†™çš„ä»£ç éƒ½å¯ä»¥ä»¥æ¥è¿‘åŸç”Ÿçš„é€Ÿåº¦åœ¨ Web ä¸­è¿è¡Œã€‚

## BOOMğŸ’¥, WebAssembly

WebAssembly æ˜¯ä¸€é—¨ä½é˜¶è¯­è¨€ï¼ˆç±»æ±‡ç¼–ï¼‰ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ç§äººç±»å¯è¯»çš„æ–‡æœ¬æ ¼å¼ï¼Œä»¥ä¾¿ç¼–å†™å’Œè°ƒè¯•ã€‚å®ƒä¸æ˜¯ç”¨æ¥å–ä»£ JS çš„ï¼Œè€Œæ˜¯è¢«è®¾è®¡ä¸ JS ååŒå·¥ä½œã€‚æ‰€ä»¥ç°ä»£æµè§ˆå™¨å¯ä»¥åŠ è½½å¹¶æ‰§è¡Œ WASM  å’Œ JS ä¸¤ç§è¯­è¨€ã€‚è€Œ Web å¼€å‘è€…æ—¢å¯ä»¥äº«å—ä½œä¸ºé«˜çº§è¯­è¨€ JS çš„çµæ´»ã€å¯è¯»ã€å¯Œæœ‰è¡¨è¾¾åŠ›ä»¥åŠåºå¤§çš„ç”Ÿæ€ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨éœ€è¦é«˜æ€§èƒ½çš„åœºæ™¯ç¼–å†™ä»¥æ¥è¿‘äºåŸç”Ÿæ€§èƒ½çš„ç¨‹åºã€‚

WebAssembly æ˜¯ä¸€ç§åŸºäº symbolic-expression ï¼ˆå¦‚ Lispï¼‰è¯­æ³•çš„è¯­è¨€ï¼Œå…¶æ–‡æœ¬æ ¼å¼çš„æ–‡ä»¶åç¼€ä¸º .watï¼Œç”¨æ¥åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ã€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ç­‰å·¥å…·ä¸­æ˜¾ç¤ºçš„ä¸­é—´å½¢å¼ã€‚

```
(module
  (func $i (import "imports" "imported_func") (param i32))
  (func (export "exported_func")
    i32.const 42
    call $i))
```

.wasm æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„æ–‡ä»¶ï¼Œé€šè¿‡ XHR æˆ– Fetch å¼•å…¥åˆ°æµè§ˆå™¨ã€‚

```js
const importObject = {
  imports: {
    imported_func(arg) {
      console.log(arg)
    }
  }
}

fetch('example.wasm').then(response =>
  response.arrayBuffer()
).then(bytes =>
  WebAssembly.instantiate(bytes, importObject)
).then(results => {
  results.instance.exports.exported_func();
});
```

[https://github.com/appcypher/awesome-wasm-langs](https://github.com/appcypher/awesome-wasm-langs) ç»´æŠ¤äº†ä¸€ä¸ªå¯ç¼–è¯‘åˆ° WASM è¯­è¨€çš„åˆ—è¡¨:

(ç¨³å®šï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ç¼–è¯‘å™¨ - æˆªæ­¢åˆ° 19-11-28)

+ .Net
+ AssemblyScript
+ Brainfuck
+ C
+ C#
+ C++
+ Clean
+ Forth
+ Go
+ Lobster
+ Lua
+ Rust
+ TypeScript
+ Wah
+ Zig

æµè§ˆå™¨å…¼å®¹æ€§ï¼š
<img :src="$withBase('/images/can-i-use-wasm.webp')" alt="can-i-use-wasm">

## æœªæ¥

> [https://github.com/WebAssembly/design/blob/master/FutureFeatures.md](https://github.com/WebAssembly/design/blob/master/FutureFeatures.md)

+ å¤šçº¿ç¨‹ï¼šWeb å·²ç»æ”¯æŒä½¿ç”¨Web Workersæ¥è¿›è¡Œå¤šçº¿ç¨‹æ‰§è¡Œï¼Œè¿™åˆšå¥½å¯ä»¥ç”¨æ¥ä½œä¸ºåœ¨ WebAssembly ä¸­å¼•å…¥å¤šçº¿ç¨‹æ‰§è¡Œçš„åŸºç¡€ã€‚
+ Web IDLç»‘å®šï¼šWeb IDL æ˜¯ä¸€ä¸ªæ¥å£å®šä¹‰è¯­è¨€ï¼Œå®ƒå¯ä»¥ç”¨æ¥å®šä¹‰åœ¨Webä¸­å®ç°çš„æ¥å£ã€‚ç®€å•çš„è¯´å°±æ˜¯åœ¨ WASM ä¸­ç›´æ¥è°ƒç”¨ Web APIã€‚
+ GC
+ å°¾é€’å½’ä¼˜åŒ–
+ å¼‚å¸¸å¤„ç†
+ ES module
